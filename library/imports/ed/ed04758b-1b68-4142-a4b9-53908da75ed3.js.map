{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Player.js"],"names":["cc","Class","extends","Component","properties","screenWidth","jumpHeight","jumpDuration","maxMoveSpeed","acceleration","jumpAudio","default","url","AudioClip","joyStick","type","Node","setJumpAction","deltaPosUp","p","deltaPosDown","jumpUp","moveBy","easing","easeCubicActionOut","jumpDown","easeCubicActionIn","callback","callFunc","playJumpSound","jumpUpForm","scaleTo","jumpDownForm","normalForm","repeatForever","sequence","audioEngine","play","setInputControl","self","on","event","detail","moveVector","x","accLeft","accRight","onLoad","node","runAction","xSpeed","director","getCollisionManager","enabled","onCollisionEnter","other","otherName","name","start","update","dt","Math","abs"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        screenWidth: 0,\r\n        //主角跳跃高度\r\n        jumpHeight: 0,\r\n        //跳跃持续时间\r\n        jumpDuration: 0,\r\n        maxMoveSpeed: 0,\r\n        acceleration: 0,\r\n\r\n        jumpAudio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n\r\n        joyStick: {\r\n            default: null,\r\n            type: cc.Node\r\n        }\r\n    },\r\n\r\n    setJumpAction: function () {\r\n        let deltaPosUp = cc.p(0, this.jumpHeight);\r\n        let deltaPosDown = cc.p(0, -this.jumpHeight);\r\n        let jumpUp = cc.moveBy(this.jumpDuration, deltaPosUp).easing(cc.easeCubicActionOut());\r\n        let jumpDown = cc.moveBy(this.jumpDuration, deltaPosDown).easing(cc.easeCubicActionIn());\r\n        var callback = cc.callFunc(this.playJumpSound, this);\r\n        let jumpUpForm = cc.scaleTo(0.03, 1, 1.1);\r\n        let jumpDownForm = cc.scaleTo(0.04, 1, 0.9);\r\n        let normalForm = cc.scaleTo(0.03, 1, 1);\r\n        return cc.repeatForever(\r\n            cc.sequence(\r\n                jumpUp,\r\n                jumpUpForm,\r\n                normalForm,\r\n                jumpDownForm,\r\n                jumpDown,\r\n                jumpDownForm,\r\n                normalForm,\r\n                jumpUpForm,\r\n                callback\r\n            )\r\n        );\r\n    },\r\n\r\n    playJumpSound: function () {\r\n        cc.audioEngine.play(this.jumpAudio, false);\r\n    },\r\n\r\n    setInputControl: function () {\r\n        var self = this;\r\n\r\n        this.joyStick.on('VirtualStick', function (event) {\r\n            if (event.detail.moveVector.x < 0) {\r\n                self.accLeft = true;\r\n                self.accRight = false;\r\n            } else if (event.detail.moveVector.x > 0) {\r\n                self.accLeft = false;\r\n                self.accRight = true;\r\n            } else {\r\n                self.accLeft = false;\r\n                self.accRight = false;\r\n            }\r\n        });\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad: function () {\r\n        this.node.runAction(this.setJumpAction());\r\n\r\n        this.accLeft = false;\r\n        this.accRight = false;\r\n\r\n        this.xSpeed = 0;\r\n\r\n        this.setInputControl();\r\n\r\n        //试验碰撞\r\n        cc.director.getCollisionManager().enabled = true;\r\n    },\r\n\r\n    onCollisionEnter: function (other, self) {\r\n        var otherName = other.node.name;\r\n        if (otherName == 'wall-left' || otherName == 'wall-right') {\r\n            if (this.xSpeed > 0) {\r\n                this.xSpeed = -this.xSpeed;\r\n            } else {\r\n                this.xSpeed = -this.xSpeed;\r\n            }\r\n        }\r\n    },\r\n\r\n    start() {\r\n\r\n    },\r\n\r\n    update(dt) {\r\n        if (this.accLeft) {\r\n            this.xSpeed -= this.acceleration * dt;\r\n        } else if (this.accRight) {\r\n            this.xSpeed += this.acceleration * dt;\r\n        }\r\n\r\n        if (Math.abs(this.xSpeed) > this.maxMoveSpeed) {\r\n            this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);\r\n        }\r\n\r\n        this.node.x += this.xSpeed * dt;\r\n    },\r\n});"]}